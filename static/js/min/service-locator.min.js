$(document).ready(function(){var e=L.AwesomeMarkers.icon({icon:"glyphicon-star",markerColor:"red"}),o=L.map("map",{scrollWheelZoom:!1}).setView([39.8282,-98.5795],4)
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:18}).addTo(o),$("#service-locator-form").on("submit",function(t){t.preventDefault(),$(".status").remove()
var i=$("#service-locator-form #zipcode").val()
if($(".service-locator-results").remove(),$(".service-locator-guide").append('<div class="service-locator-results"></div>'),i){$(".service-locator-map").prepend("<div class='status loading'><span class='glyphicon glyphicon-refresh'></span> Loading</div>")
var s="",a="",r=[]
$.getJSON("//maps.googleapis.com/maps/api/geocode/json?address="+i+"&sensor=false").done(function(e){s=e.results[0].geometry.location.lat,a=e.results[0].geometry.location.lng,r=[e.results[0].geometry.location.lat,e.results[0].geometry.location.lng],o.setView(new L.LatLng(s,a),8)}),$.ajax({url:"https://api.rainn.org/centers/v1/centers/zip/"+i,headers:{Authorization:"Basic dGVzdDp0ZXN0"},dataType:"json"}).done(function(t){function i(e,o){var t=geolib.getDistance({latitude:s,longitude:a},{latitude:e.latitude,longitude:e.longitude}),i=geolib.getDistance({latitude:s,longitude:a},{latitude:o.latitude,longitude:o.longitude})
return t<i?-1:t>i?1:0}$(".status").remove()
var r=t
r.sort(i),$.each(r,function(t,i){new L.marker([i.latitude,i.longitude],{icon:e,title:i.name}).on("click",function(e){$(".service").removeClass("selected"),$("#"+i.id).addClass("selected"),$(".service-locator-results").scrollTop($(".service-locator-results").scrollTop()+$("#"+i.id).position().top)}).addTo(o)
$(".service-locator-results").append('<div class="service" id="'+i.id+'"></div>'),$("#"+i.id).append('<div class="service-name"><a href="'+i.url+'" target="_blank">'+i.name+'</a></div><div class="service-location">'+i.city+", "+i.state+"</div>"),i.hotline&&("null"===i.hotline||$("#"+i.id).append('<div class="service-hotline">Hotline: '+i.hotline+"</div>")),i.hotlinePhone&&$("#"+i.id).append('<div class="service-hotline">Hotline: '+i.hotlinePhone+"</div>"),i.businessPhone&&$("#"+i.id).append('<div class="service-phone">Phone: '+i.hotlinePhone+"</div>")})})}else $(".service-locator-map").prepend("<div class='status'>You did not provide a proper zipcode!</div>")})})
